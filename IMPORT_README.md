#!/bin/bash

echo "CSV Import Tool for Fasty Database"
echo "==================================="
echo ""
echo "This script imports CSV files into your Fasty database."
echo ""
echo "Usage:"
echo "  go run import_csv.go [flags] <csv_file>"
echo ""
echo "Flags:"
echo "  -batch-size int    Number of rows per batch (default 10000)"
echo "  -workers int       Number of concurrent workers (default CPU cores * 2)"
echo ""
echo "Requirements:"
echo "  - Fasty server must be running on http://localhost:1337"
echo ""
echo "Performance Optimizations:"
echo "  - Concurrent workers for parallel batch processing"
echo "  - Large batch sizes (10k rows per batch)"
echo "  - Buffered I/O for fast CSV reading (64MB buffer)"
echo "  - Optimized JSON generation using strings.Builder"
echo "  - HTTP connection pooling (500 max connections)"
echo "  - Real-time progress reporting"
echo ""
echo "Features:"
echo "  - Automatic column name sanitization"
echo "  - Batch processing for high performance"
echo "  - Concurrent workers for parallel processing"
echo "  - Progress reporting with import rates"
echo "  - Error handling and recovery"
echo "  - Suitable for large CSV files (GBs+)"
echo "  - All columns imported as strings (for simplicity)"
echo ""
echo "Examples:"
echo "  go run import_csv.go Transactions_clean.csv"
echo "  go run import_csv.go -batch-size=50000 -workers=16 Transactions_clean.csv"
echo ""
echo "Column Name Sanitization:"
echo "  CSV headers with special characters are automatically sanitized:"
echo "  - 'built_up_area_(sqft)' becomes 'built_up_area_sqft'"
echo "  - 'sale_price_per_foot' becomes 'sale_price_per_foot'"
echo "  - All special characters are replaced with underscores"
echo ""
echo "Performance Tuning:"
echo "  - Increase -batch-size for fewer, larger HTTP requests"
echo "  - Increase -workers for more parallelism (up to 32)"
echo "  - Use SSD storage for better I/O performance"
echo "  - Ensure fasty server has sufficient memory"
echo ""
echo "The script will:"
echo "  1. Read the CSV headers"
echo "  2. Create a 'transactions' table with appropriate column types"
echo "  3. Import data in batches (configurable, default 10k rows)"
echo "  4. Show progress and final statistics"